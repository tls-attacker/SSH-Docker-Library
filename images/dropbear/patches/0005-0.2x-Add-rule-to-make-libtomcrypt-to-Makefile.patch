From 21f2352308dff1eb2e7b013bd56238fe9835ecee Mon Sep 17 00:00:00 2001
From: Jan Holthuis <jan.holthuis@ruhr-uni-bochum.de>
Date: Fri, 19 Aug 2022 13:31:19 +0200
Subject: [PATCH] [0.2x] Add rule to make libtomcrypt to Makefile

This avoids having to run make -C libtomcrypt manually.
---
 Makefile.in | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index b3306e8..503cf29 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -1,7 +1,8 @@
 CC=@CC@
 LD=@CC@
 CFLAGS=-Wall -Ilibtomcrypt @CFLAGS@
-LIBS=libtomcrypt/libtomcrypt.a @LIBS@
+LTC=libtomcrypt/libtomcrypt.a
+LIBS=$(LTC) @LIBS@
 LDFLAGS=@LDFLAGS@
 
 OBJS=util.o session.o packet.o algo.o buffer.o kex.o dss.o bignum.o \
@@ -24,7 +25,13 @@ UCLIBC_CC=/home/matt/uclibc/bin/i386-uclibc-gcc
 
 all: dropbear dropbearkey
 
-$(OBJS): $(HEADERS) Makefile
+$(OBJS): $(HEADERS) $(LTC) Makefile
+
+$(LTC): $(HEADERS)
+	cd libtomcrypt && $(MAKE) clean && $(MAKE)
+
+ltc-clean:
+	cd libtomcrypt && $(MAKE) clean
 
 dropbear: $(DROPBEAROBJS) $(HEADERS) Makefile 
 	$(LD) $(LDFLAGS) -o dropbear $(DROPBEAROBJS) $(LIBS)
-- 
2.37.1

